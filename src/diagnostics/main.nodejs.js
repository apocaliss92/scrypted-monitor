(()=>{var e={743:function(e,t,r){"use strict";var i=this&&this.__createBinding||(Object.create?function(e,t,r,i){void 0===i&&(i=r);var o=Object.getOwnPropertyDescriptor(t,r);o&&!("get"in o?!t.__esModule:o.writable||o.configurable)||(o={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,i,o)}:function(e,t,r,i){void 0===i&&(i=r),e[i]=t[r]}),o=this&&this.__exportStar||function(e,t){for(var r in e)"default"===r||Object.prototype.hasOwnProperty.call(t,r)||i(t,e,r)};Object.defineProperty(t,"__esModule",{value:!0}),t.sdk=t.MixinDeviceBase=t.ScryptedDeviceBase=void 0,o(r(849),t);const n=r(849);class s extends n.DeviceBase{constructor(e){super(),this.nativeId=e}get storage(){return this._storage||(this._storage=deviceManager.getDeviceStorage(this.nativeId)),this._storage}get log(){return this._log||(this._log=deviceManager.getDeviceLogger(this.nativeId)),this._log}get console(){return this._console||(this._console=deviceManager.getDeviceConsole(this.nativeId)),this._console}async createMediaObject(e,t){return mediaManager.createMediaObject(e,t,{sourceId:this.id})}getMediaObjectConsole(e){return"string"!=typeof e.sourceId?this.console:deviceManager.getMixinConsole(e.sourceId,this.nativeId)}_lazyLoadDeviceState(){this._deviceState||(this.nativeId?this._deviceState=deviceManager.getDeviceState(this.nativeId):this._deviceState=deviceManager.getDeviceState())}onDeviceEvent(e,t){return deviceManager.onDeviceEvent(this.nativeId,e,t)}}t.ScryptedDeviceBase=s;class a extends n.DeviceBase{constructor(e){super(),this._listeners=new Set,this.mixinDevice=e.mixinDevice,this.mixinDeviceInterfaces=e.mixinDeviceInterfaces,this.mixinStorageSuffix=e.mixinStorageSuffix,this._deviceState=e.mixinDeviceState,this.nativeId=systemManager.getDeviceById(this.id).nativeId,this.mixinProviderNativeId=e.mixinProviderNativeId,this._deviceState.__rpcproxy_traps_all_properties&&"string"==typeof this._deviceState.id&&(this._deviceState=deviceManager.createDeviceState(this._deviceState.id,this._deviceState.setState))}get storage(){if(!this._storage){const e=this.mixinStorageSuffix,t=this.id+(e?":"+e:"");this._storage=deviceManager.getMixinStorage(t,this.mixinProviderNativeId)}return this._storage}get console(){return this._console||(deviceManager.getMixinConsole?this._console=deviceManager.getMixinConsole(this.id,this.mixinProviderNativeId):this._console=deviceManager.getDeviceConsole(this.mixinProviderNativeId)),this._console}async createMediaObject(e,t){return mediaManager.createMediaObject(e,t,{sourceId:this.id})}getMediaObjectConsole(e){return"string"!=typeof e.sourceId?this.console:deviceManager.getMixinConsole(e.sourceId,this.mixinProviderNativeId)}onDeviceEvent(e,t){return deviceManager.onMixinEvent(this.id,this,e,t)}_lazyLoadDeviceState(){}manageListener(e){this._listeners.add(e)}release(){for(const e of this._listeners)e.removeListener()}}t.MixinDeviceBase=a,function(){function e(e){return function(){return this._lazyLoadDeviceState(),this._deviceState?.[e]}}function t(e){return function(t){this._lazyLoadDeviceState(),this._deviceState?this._deviceState[e]=t:console.warn("device state is unavailable. the device must be discovered with deviceManager.onDeviceDiscovered or deviceManager.onDevicesChanged before the state can be set.")}}for(const r of Object.values(n.ScryptedInterfaceProperty))r!==n.ScryptedInterfaceProperty.nativeId&&(Object.defineProperty(s.prototype,r,{set:t(r),get:e(r)}),Object.defineProperty(a.prototype,r,{set:t(r),get:e(r)}))}(),t.sdk={};try{let e;try{e=pluginRuntimeAPI}catch(e){}Object.assign(t.sdk,{log:deviceManager.getDeviceLogger(void 0),deviceManager,endpointManager,mediaManager,systemManager,pluginHostAPI,...e});try{systemManager.setScryptedInterfaceDescriptors?.(n.TYPES_VERSION,n.ScryptedInterfaceDescriptors)?.catch((()=>{}))}catch(e){}}catch(e){console.error("sdk initialization error, import @scrypted/types or use @scrypted/client instead",e)}t.default=t.sdk},414:function(e,t,r){"use strict";var i=this&&this.__createBinding||(Object.create?function(e,t,r,i){void 0===i&&(i=r);var o=Object.getOwnPropertyDescriptor(t,r);o&&!("get"in o?!t.__esModule:o.writable||o.configurable)||(o={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,i,o)}:function(e,t,r,i){void 0===i&&(i=r),e[i]=t[r]}),o=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),n=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)"default"!==r&&Object.prototype.hasOwnProperty.call(e,r)&&i(t,e,r);return o(t,e),t};Object.defineProperty(t,"__esModule",{value:!0}),t.StorageSettings=void 0;const s=n(r(743)),{systemManager:a}=s.default;t.StorageSettings=class{constructor(e,t){this.device=e,this.settings=t,this.values={},this.hasValue={};for(const e of Object.keys(t)){const r=t[e],i=()=>this.getItem(e);let o;o="clippath"!==r.type?i:()=>{try{return JSON.parse(i())}catch(e){}},Object.defineProperty(this.values,e,{get:o,set:t=>this.putSetting(e,t),enumerable:!0}),Object.defineProperty(this.hasValue,e,{get:()=>null!=this.device.storage.getItem(e),enumerable:!0})}}get keys(){const e={};for(const t of Object.keys(this.settings))e[t]=t;return e}async getSettings(){const e=await(this.options?.onGet?.()),t=[];for(const[r,i]of Object.entries(this.settings)){let o=Object.assign({},i);e?.[r]&&(o=Object.assign(o,e[r])),o.onGet&&(o=Object.assign(o,await o.onGet())),o.hide||await(this.options?.hide?.[r]?.())||(o.key=r,o.value=this.getItemInternal(r,o,!0),t.push(o),delete o.onPut,delete o.onGet,delete o.mapPut,delete o.mapGet)}return t}async putSetting(e,t){const r=this.settings[e];let i;return r&&(i=this.getItemInternal(e,r)),this.putSettingInternal(r,i,e,t)}putSettingInternal(e,t,r,i){e?.noStore||(e?.mapPut&&(i=e.mapPut(t,i)),null==i?this.device.storage.removeItem(r):"object"==typeof i?this.device.storage.setItem(r,JSON.stringify(i)):this.device.storage.setItem(r,i?.toString())),e?.onPut?.(t,i),e?.hide||this.device.onDeviceEvent(s.ScryptedInterface.Settings,void 0)}getItemInternal(e,t,r){if(!t)return this.device.storage.getItem(e);const i=function(e,t,r,i){if(null==e)return r();const o=t.multiple?"array":t.type;if("boolean"===o)return"true"===e||"false"!==e&&(r()||!1);if("number"===o){const t=parseFloat(e);return isNaN(t)?r()||0:t}if("integer"===o){const t=parseInt(e);return isNaN(t)?r()||0:t}if("array"===o){if(!e)return r()||[];try{return JSON.parse(e)}catch(e){return r()||[]}}if("device"===o)return i?e:a.getDeviceById(e)||a.getDeviceById(r());if(e&&t.json)try{return JSON.parse(e)}catch(e){return r()}return e||r()}(this.device.storage.getItem(e),t,(()=>null!=t.persistedDefaultValue?(this.putSettingInternal(t,void 0,e,t.persistedDefaultValue),t.persistedDefaultValue):t.defaultValue),r);return t.mapGet?t.mapGet(i):i}getItem(e){return this.getItemInternal(e,this.settings[e])}}},849:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ScryptedMimeTypes=t.ScryptedInterface=t.MediaPlayerState=t.SecuritySystemObstruction=t.SecuritySystemMode=t.AirQuality=t.AirPurifierMode=t.AirPurifierStatus=t.ChargeState=t.LockState=t.PanTiltZoomMovement=t.ThermostatMode=t.TemperatureUnit=t.FanMode=t.HumidityMode=t.ScryptedDeviceType=t.ScryptedInterfaceDescriptors=t.ScryptedInterfaceMethod=t.ScryptedInterfaceProperty=t.DeviceBase=t.TYPES_VERSION=void 0,t.TYPES_VERSION="0.3.64";var r,i,o,n,s,a,c,d,p,u,l,m,h,f,g,y,v,S;t.DeviceBase=class{},function(e){e.id="id",e.info="info",e.interfaces="interfaces",e.mixins="mixins",e.name="name",e.nativeId="nativeId",e.pluginId="pluginId",e.providedInterfaces="providedInterfaces",e.providedName="providedName",e.providedRoom="providedRoom",e.providedType="providedType",e.providerId="providerId",e.room="room",e.type="type",e.scryptedRuntimeArguments="scryptedRuntimeArguments",e.on="on",e.brightness="brightness",e.colorTemperature="colorTemperature",e.rgb="rgb",e.hsv="hsv",e.running="running",e.paused="paused",e.docked="docked",e.temperatureSetting="temperatureSetting",e.temperature="temperature",e.temperatureUnit="temperatureUnit",e.humidity="humidity",e.audioVolumes="audioVolumes",e.recordingActive="recordingActive",e.ptzCapabilities="ptzCapabilities",e.lockState="lockState",e.entryOpen="entryOpen",e.batteryLevel="batteryLevel",e.chargeState="chargeState",e.online="online",e.fromMimeType="fromMimeType",e.toMimeType="toMimeType",e.converters="converters",e.binaryState="binaryState",e.tampered="tampered",e.powerDetected="powerDetected",e.audioDetected="audioDetected",e.motionDetected="motionDetected",e.ambientLight="ambientLight",e.occupied="occupied",e.flooded="flooded",e.ultraviolet="ultraviolet",e.luminance="luminance",e.position="position",e.securitySystemState="securitySystemState",e.pm10Density="pm10Density",e.pm25Density="pm25Density",e.vocDensity="vocDensity",e.noxDensity="noxDensity",e.co2ppm="co2ppm",e.airQuality="airQuality",e.airPurifierState="airPurifierState",e.filterChangeIndication="filterChangeIndication",e.filterLifeLevel="filterLifeLevel",e.humiditySetting="humiditySetting",e.fan="fan",e.applicationInfo="applicationInfo",e.systemDevice="systemDevice"}(r||(t.ScryptedInterfaceProperty=r={})),function(e){e.listen="listen",e.probe="probe",e.setMixins="setMixins",e.setName="setName",e.setRoom="setRoom",e.setType="setType",e.getPluginJson="getPluginJson",e.turnOff="turnOff",e.turnOn="turnOn",e.setBrightness="setBrightness",e.getTemperatureMaxK="getTemperatureMaxK",e.getTemperatureMinK="getTemperatureMinK",e.setColorTemperature="setColorTemperature",e.setRgb="setRgb",e.setHsv="setHsv",e.sendNotification="sendNotification",e.start="start",e.stop="stop",e.pause="pause",e.resume="resume",e.dock="dock",e.setTemperature="setTemperature",e.setTemperatureUnit="setTemperatureUnit",e.getPictureOptions="getPictureOptions",e.takePicture="takePicture",e.getAudioStream="getAudioStream",e.setAudioVolumes="setAudioVolumes",e.startDisplay="startDisplay",e.stopDisplay="stopDisplay",e.getVideoStream="getVideoStream",e.getVideoStreamOptions="getVideoStreamOptions",e.getPrivacyMasks="getPrivacyMasks",e.setPrivacyMasks="setPrivacyMasks",e.getRecordingStream="getRecordingStream",e.getRecordingStreamCurrentTime="getRecordingStreamCurrentTime",e.getRecordingStreamOptions="getRecordingStreamOptions",e.getRecordingStreamThumbnail="getRecordingStreamThumbnail",e.deleteRecordingStream="deleteRecordingStream",e.setRecordingActive="setRecordingActive",e.ptzCommand="ptzCommand",e.getRecordedEvents="getRecordedEvents",e.getVideoClip="getVideoClip",e.getVideoClips="getVideoClips",e.getVideoClipThumbnail="getVideoClipThumbnail",e.removeVideoClips="removeVideoClips",e.setVideoStreamOptions="setVideoStreamOptions",e.startIntercom="startIntercom",e.stopIntercom="stopIntercom",e.lock="lock",e.unlock="unlock",e.addPassword="addPassword",e.getPasswords="getPasswords",e.removePassword="removePassword",e.activate="activate",e.deactivate="deactivate",e.isReversible="isReversible",e.closeEntry="closeEntry",e.openEntry="openEntry",e.getDevice="getDevice",e.releaseDevice="releaseDevice",e.adoptDevice="adoptDevice",e.discoverDevices="discoverDevices",e.createDevice="createDevice",e.getCreateDeviceSettings="getCreateDeviceSettings",e.reboot="reboot",e.getRefreshFrequency="getRefreshFrequency",e.refresh="refresh",e.getMediaStatus="getMediaStatus",e.load="load",e.seek="seek",e.skipNext="skipNext",e.skipPrevious="skipPrevious",e.convert="convert",e.convertMedia="convertMedia",e.getSettings="getSettings",e.putSetting="putSetting",e.armSecuritySystem="armSecuritySystem",e.disarmSecuritySystem="disarmSecuritySystem",e.setAirPurifierState="setAirPurifierState",e.getReadmeMarkdown="getReadmeMarkdown",e.getOauthUrl="getOauthUrl",e.onOauthCallback="onOauthCallback",e.canMixin="canMixin",e.getMixin="getMixin",e.releaseMixin="releaseMixin",e.onRequest="onRequest",e.onConnection="onConnection",e.onPush="onPush",e.run="run",e.eval="eval",e.loadScripts="loadScripts",e.saveScript="saveScript",e.trackObjects="trackObjects",e.getDetectionInput="getDetectionInput",e.getObjectTypes="getObjectTypes",e.detectObjects="detectObjects",e.generateObjectDetections="generateObjectDetections",e.getDetectionModel="getDetectionModel",e.setHumidity="setHumidity",e.setFan="setFan",e.startRTCSignalingSession="startRTCSignalingSession",e.createRTCSignalingSession="createRTCSignalingSession",e.getScryptedUserAccessControl="getScryptedUserAccessControl",e.generateVideoFrames="generateVideoFrames",e.connectStream="connectStream",e.getTTYSettings="getTTYSettings"}(i||(t.ScryptedInterfaceMethod=i={})),t.ScryptedInterfaceDescriptors={ScryptedDevice:{name:"ScryptedDevice",methods:["listen","probe","setMixins","setName","setRoom","setType"],properties:["id","info","interfaces","mixins","name","nativeId","pluginId","providedInterfaces","providedName","providedRoom","providedType","providerId","room","type"]},ScryptedPlugin:{name:"ScryptedPlugin",methods:["getPluginJson"],properties:[]},ScryptedPluginRuntime:{name:"ScryptedPluginRuntime",methods:[],properties:["scryptedRuntimeArguments"]},OnOff:{name:"OnOff",methods:["turnOff","turnOn"],properties:["on"]},Brightness:{name:"Brightness",methods:["setBrightness"],properties:["brightness"]},ColorSettingTemperature:{name:"ColorSettingTemperature",methods:["getTemperatureMaxK","getTemperatureMinK","setColorTemperature"],properties:["colorTemperature"]},ColorSettingRgb:{name:"ColorSettingRgb",methods:["setRgb"],properties:["rgb"]},ColorSettingHsv:{name:"ColorSettingHsv",methods:["setHsv"],properties:["hsv"]},Notifier:{name:"Notifier",methods:["sendNotification"],properties:[]},StartStop:{name:"StartStop",methods:["start","stop"],properties:["running"]},Pause:{name:"Pause",methods:["pause","resume"],properties:["paused"]},Dock:{name:"Dock",methods:["dock"],properties:["docked"]},TemperatureSetting:{name:"TemperatureSetting",methods:["setTemperature"],properties:["temperatureSetting"]},Thermometer:{name:"Thermometer",methods:["setTemperatureUnit"],properties:["temperature","temperatureUnit"]},HumiditySensor:{name:"HumiditySensor",methods:[],properties:["humidity"]},Camera:{name:"Camera",methods:["getPictureOptions","takePicture"],properties:[]},Microphone:{name:"Microphone",methods:["getAudioStream"],properties:[]},AudioVolumeControl:{name:"AudioVolumeControl",methods:["setAudioVolumes"],properties:["audioVolumes"]},Display:{name:"Display",methods:["startDisplay","stopDisplay"],properties:[]},VideoCamera:{name:"VideoCamera",methods:["getVideoStream","getVideoStreamOptions"],properties:[]},VideoCameraMask:{name:"VideoCameraMask",methods:["getPrivacyMasks","setPrivacyMasks"],properties:[]},VideoRecorder:{name:"VideoRecorder",methods:["getRecordingStream","getRecordingStreamCurrentTime","getRecordingStreamOptions","getRecordingStreamThumbnail"],properties:["recordingActive"]},VideoRecorderManagement:{name:"VideoRecorderManagement",methods:["deleteRecordingStream","setRecordingActive"],properties:[]},PanTiltZoom:{name:"PanTiltZoom",methods:["ptzCommand"],properties:["ptzCapabilities"]},EventRecorder:{name:"EventRecorder",methods:["getRecordedEvents"],properties:[]},VideoClips:{name:"VideoClips",methods:["getVideoClip","getVideoClips","getVideoClipThumbnail","removeVideoClips"],properties:[]},VideoCameraConfiguration:{name:"VideoCameraConfiguration",methods:["setVideoStreamOptions"],properties:[]},Intercom:{name:"Intercom",methods:["startIntercom","stopIntercom"],properties:[]},Lock:{name:"Lock",methods:["lock","unlock"],properties:["lockState"]},PasswordStore:{name:"PasswordStore",methods:["addPassword","getPasswords","removePassword"],properties:[]},Scene:{name:"Scene",methods:["activate","deactivate","isReversible"],properties:[]},Entry:{name:"Entry",methods:["closeEntry","openEntry"],properties:[]},EntrySensor:{name:"EntrySensor",methods:[],properties:["entryOpen"]},DeviceProvider:{name:"DeviceProvider",methods:["getDevice","releaseDevice"],properties:[]},DeviceDiscovery:{name:"DeviceDiscovery",methods:["adoptDevice","discoverDevices"],properties:[]},DeviceCreator:{name:"DeviceCreator",methods:["createDevice","getCreateDeviceSettings"],properties:[]},Battery:{name:"Battery",methods:[],properties:["batteryLevel"]},Charger:{name:"Charger",methods:[],properties:["chargeState"]},Reboot:{name:"Reboot",methods:["reboot"],properties:[]},Refresh:{name:"Refresh",methods:["getRefreshFrequency","refresh"],properties:[]},MediaPlayer:{name:"MediaPlayer",methods:["getMediaStatus","load","seek","skipNext","skipPrevious"],properties:[]},Online:{name:"Online",methods:[],properties:["online"]},BufferConverter:{name:"BufferConverter",methods:["convert"],properties:["fromMimeType","toMimeType"]},MediaConverter:{name:"MediaConverter",methods:["convertMedia"],properties:["converters"]},Settings:{name:"Settings",methods:["getSettings","putSetting"],properties:[]},BinarySensor:{name:"BinarySensor",methods:[],properties:["binaryState"]},TamperSensor:{name:"TamperSensor",methods:[],properties:["tampered"]},PowerSensor:{name:"PowerSensor",methods:[],properties:["powerDetected"]},AudioSensor:{name:"AudioSensor",methods:[],properties:["audioDetected"]},MotionSensor:{name:"MotionSensor",methods:[],properties:["motionDetected"]},AmbientLightSensor:{name:"AmbientLightSensor",methods:[],properties:["ambientLight"]},OccupancySensor:{name:"OccupancySensor",methods:[],properties:["occupied"]},FloodSensor:{name:"FloodSensor",methods:[],properties:["flooded"]},UltravioletSensor:{name:"UltravioletSensor",methods:[],properties:["ultraviolet"]},LuminanceSensor:{name:"LuminanceSensor",methods:[],properties:["luminance"]},PositionSensor:{name:"PositionSensor",methods:[],properties:["position"]},SecuritySystem:{name:"SecuritySystem",methods:["armSecuritySystem","disarmSecuritySystem"],properties:["securitySystemState"]},PM10Sensor:{name:"PM10Sensor",methods:[],properties:["pm10Density"]},PM25Sensor:{name:"PM25Sensor",methods:[],properties:["pm25Density"]},VOCSensor:{name:"VOCSensor",methods:[],properties:["vocDensity"]},NOXSensor:{name:"NOXSensor",methods:[],properties:["noxDensity"]},CO2Sensor:{name:"CO2Sensor",methods:[],properties:["co2ppm"]},AirQualitySensor:{name:"AirQualitySensor",methods:[],properties:["airQuality"]},AirPurifier:{name:"AirPurifier",methods:["setAirPurifierState"],properties:["airPurifierState"]},FilterMaintenance:{name:"FilterMaintenance",methods:[],properties:["filterChangeIndication","filterLifeLevel"]},Readme:{name:"Readme",methods:["getReadmeMarkdown"],properties:[]},OauthClient:{name:"OauthClient",methods:["getOauthUrl","onOauthCallback"],properties:[]},MixinProvider:{name:"MixinProvider",methods:["canMixin","getMixin","releaseMixin"],properties:[]},HttpRequestHandler:{name:"HttpRequestHandler",methods:["onRequest"],properties:[]},EngineIOHandler:{name:"EngineIOHandler",methods:["onConnection"],properties:[]},PushHandler:{name:"PushHandler",methods:["onPush"],properties:[]},Program:{name:"Program",methods:["run"],properties:[]},Scriptable:{name:"Scriptable",methods:["eval","loadScripts","saveScript"],properties:[]},ObjectTracker:{name:"ObjectTracker",methods:["trackObjects"],properties:[]},ObjectDetector:{name:"ObjectDetector",methods:["getDetectionInput","getObjectTypes"],properties:[]},ObjectDetection:{name:"ObjectDetection",methods:["detectObjects","generateObjectDetections","getDetectionModel"],properties:[]},ObjectDetectionPreview:{name:"ObjectDetectionPreview",methods:[],properties:[]},ObjectDetectionGenerator:{name:"ObjectDetectionGenerator",methods:[],properties:[]},HumiditySetting:{name:"HumiditySetting",methods:["setHumidity"],properties:["humiditySetting"]},Fan:{name:"Fan",methods:["setFan"],properties:["fan"]},RTCSignalingChannel:{name:"RTCSignalingChannel",methods:["startRTCSignalingSession"],properties:[]},RTCSignalingClient:{name:"RTCSignalingClient",methods:["createRTCSignalingSession"],properties:[]},LauncherApplication:{name:"LauncherApplication",methods:[],properties:["applicationInfo"]},ScryptedUser:{name:"ScryptedUser",methods:["getScryptedUserAccessControl"],properties:[]},VideoFrameGenerator:{name:"VideoFrameGenerator",methods:["generateVideoFrames"],properties:[]},StreamService:{name:"StreamService",methods:["connectStream"],properties:[]},TTY:{name:"TTY",methods:[],properties:[]},TTYSettings:{name:"TTYSettings",methods:["getTTYSettings"],properties:[]},ScryptedSystemDevice:{name:"ScryptedSystemDevice",methods:[],properties:["systemDevice"]},ScryptedDeviceCreator:{name:"ScryptedDeviceCreator",methods:[],properties:[]},ScryptedSettings:{name:"ScryptedSettings",methods:[],properties:[]}},function(e){e.Builtin="Builtin",e.Camera="Camera",e.Fan="Fan",e.Light="Light",e.Switch="Switch",e.Outlet="Outlet",e.Sensor="Sensor",e.Scene="Scene",e.Program="Program",e.Automation="Automation",e.Vacuum="Vacuum",e.Notifier="Notifier",e.Thermostat="Thermostat",e.Lock="Lock",e.PasswordControl="PasswordControl",e.Display="Display",e.SmartDisplay="SmartDisplay",e.Speaker="Speaker",e.SmartSpeaker="SmartSpeaker",e.Event="Event",e.Entry="Entry",e.Garage="Garage",e.DeviceProvider="DeviceProvider",e.DataSource="DataSource",e.API="API",e.Doorbell="Doorbell",e.Irrigation="Irrigation",e.Valve="Valve",e.Person="Person",e.SecuritySystem="SecuritySystem",e.WindowCovering="WindowCovering",e.Siren="Siren",e.AirPurifier="AirPurifier",e.Unknown="Unknown"}(o||(t.ScryptedDeviceType=o={})),function(e){e.Humidify="Humidify",e.Dehumidify="Dehumidify",e.Auto="Auto",e.Off="Off"}(n||(t.HumidityMode=n={})),function(e){e.Auto="Auto",e.Manual="Manual"}(s||(t.FanMode=s={})),function(e){e.C="C",e.F="F"}(a||(t.TemperatureUnit=a={})),function(e){e.Off="Off",e.Cool="Cool",e.Heat="Heat",e.HeatCool="HeatCool",e.Auto="Auto",e.FanOnly="FanOnly",e.Purifier="Purifier",e.Eco="Eco",e.Dry="Dry",e.On="On"}(c||(t.ThermostatMode=c={})),function(e){e.Absolute="Absolute",e.Relative="Relative",e.Continuous="Continuous",e.Preset="Preset",e.Home="Home"}(d||(t.PanTiltZoomMovement=d={})),function(e){e.Locked="Locked",e.Unlocked="Unlocked",e.Jammed="Jammed"}(p||(t.LockState=p={})),function(e){e.Trickle="trickle",e.Charging="charging",e.NotCharging="not-charging"}(u||(t.ChargeState=u={})),function(e){e.Inactive="Inactive",e.Idle="Idle",e.Active="Active",e.ActiveNightMode="ActiveNightMode"}(l||(t.AirPurifierStatus=l={})),function(e){e.Manual="Manual",e.Automatic="Automatic"}(m||(t.AirPurifierMode=m={})),function(e){e.Unknown="Unknown",e.Excellent="Excellent",e.Good="Good",e.Fair="Fair",e.Inferior="Inferior",e.Poor="Poor"}(h||(t.AirQuality=h={})),function(e){e.Disarmed="Disarmed",e.HomeArmed="HomeArmed",e.AwayArmed="AwayArmed",e.NightArmed="NightArmed"}(f||(t.SecuritySystemMode=f={})),function(e){e.Sensor="Sensor",e.Occupied="Occupied",e.Time="Time",e.Error="Error"}(g||(t.SecuritySystemObstruction=g={})),function(e){e.Idle="Idle",e.Playing="Playing",e.Paused="Paused",e.Buffering="Buffering"}(y||(t.MediaPlayerState=y={})),function(e){e.ScryptedDevice="ScryptedDevice",e.ScryptedPlugin="ScryptedPlugin",e.ScryptedPluginRuntime="ScryptedPluginRuntime",e.OnOff="OnOff",e.Brightness="Brightness",e.ColorSettingTemperature="ColorSettingTemperature",e.ColorSettingRgb="ColorSettingRgb",e.ColorSettingHsv="ColorSettingHsv",e.Notifier="Notifier",e.StartStop="StartStop",e.Pause="Pause",e.Dock="Dock",e.TemperatureSetting="TemperatureSetting",e.Thermometer="Thermometer",e.HumiditySensor="HumiditySensor",e.Camera="Camera",e.Microphone="Microphone",e.AudioVolumeControl="AudioVolumeControl",e.Display="Display",e.VideoCamera="VideoCamera",e.VideoCameraMask="VideoCameraMask",e.VideoRecorder="VideoRecorder",e.VideoRecorderManagement="VideoRecorderManagement",e.PanTiltZoom="PanTiltZoom",e.EventRecorder="EventRecorder",e.VideoClips="VideoClips",e.VideoCameraConfiguration="VideoCameraConfiguration",e.Intercom="Intercom",e.Lock="Lock",e.PasswordStore="PasswordStore",e.Scene="Scene",e.Entry="Entry",e.EntrySensor="EntrySensor",e.DeviceProvider="DeviceProvider",e.DeviceDiscovery="DeviceDiscovery",e.DeviceCreator="DeviceCreator",e.Battery="Battery",e.Charger="Charger",e.Reboot="Reboot",e.Refresh="Refresh",e.MediaPlayer="MediaPlayer",e.Online="Online",e.BufferConverter="BufferConverter",e.MediaConverter="MediaConverter",e.Settings="Settings",e.BinarySensor="BinarySensor",e.TamperSensor="TamperSensor",e.PowerSensor="PowerSensor",e.AudioSensor="AudioSensor",e.MotionSensor="MotionSensor",e.AmbientLightSensor="AmbientLightSensor",e.OccupancySensor="OccupancySensor",e.FloodSensor="FloodSensor",e.UltravioletSensor="UltravioletSensor",e.LuminanceSensor="LuminanceSensor",e.PositionSensor="PositionSensor",e.SecuritySystem="SecuritySystem",e.PM10Sensor="PM10Sensor",e.PM25Sensor="PM25Sensor",e.VOCSensor="VOCSensor",e.NOXSensor="NOXSensor",e.CO2Sensor="CO2Sensor",e.AirQualitySensor="AirQualitySensor",e.AirPurifier="AirPurifier",e.FilterMaintenance="FilterMaintenance",e.Readme="Readme",e.OauthClient="OauthClient",e.MixinProvider="MixinProvider",e.HttpRequestHandler="HttpRequestHandler",e.EngineIOHandler="EngineIOHandler",e.PushHandler="PushHandler",e.Program="Program",e.Scriptable="Scriptable",e.ObjectTracker="ObjectTracker",e.ObjectDetector="ObjectDetector",e.ObjectDetection="ObjectDetection",e.ObjectDetectionPreview="ObjectDetectionPreview",e.ObjectDetectionGenerator="ObjectDetectionGenerator",e.HumiditySetting="HumiditySetting",e.Fan="Fan",e.RTCSignalingChannel="RTCSignalingChannel",e.RTCSignalingClient="RTCSignalingClient",e.LauncherApplication="LauncherApplication",e.ScryptedUser="ScryptedUser",e.VideoFrameGenerator="VideoFrameGenerator",e.StreamService="StreamService",e.TTY="TTY",e.TTYSettings="TTYSettings",e.ScryptedSystemDevice="ScryptedSystemDevice",e.ScryptedDeviceCreator="ScryptedDeviceCreator",e.ScryptedSettings="ScryptedSettings"}(v||(t.ScryptedInterface=v={})),function(e){e.Url="text/x-uri",e.InsecureLocalUrl="text/x-insecure-local-uri",e.LocalUrl="text/x-local-uri",e.ServerId="text/x-server-id",e.PushEndpoint="text/x-push-endpoint",e.SchemePrefix="x-scrypted/x-scrypted-scheme-",e.MediaStreamUrl="text/x-media-url",e.MediaObject="x-scrypted/x-scrypted-media-object",e.RequestMediaObject="x-scrypted/x-scrypted-request-media-object",e.RequestMediaStream="x-scrypted/x-scrypted-request-stream",e.MediaStreamFeedback="x-scrypted/x-media-stream-feedback",e.FFmpegInput="x-scrypted/x-ffmpeg-input",e.FFmpegTranscodeStream="x-scrypted/x-ffmpeg-transcode-stream",e.RTCSignalingChannel="x-scrypted/x-scrypted-rtc-signaling-channel",e.RTCSignalingSession="x-scrypted/x-scrypted-rtc-signaling-session",e.RTCConnectionManagement="x-scrypted/x-scrypted-rtc-connection-management",e.Image="x-scrypted/x-scrypted-image"}(S||(t.ScryptedMimeTypes=S={}))},643:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.safePrintFFmpegArguments=t.ffmpegLogInitialOutput=t.safeKillFFmpeg=void 0;var i=r(989);Object.defineProperty(t,"safeKillFFmpeg",{enumerable:!0,get:function(){return i.safeKillFFmpeg}}),Object.defineProperty(t,"ffmpegLogInitialOutput",{enumerable:!0,get:function(){return i.ffmpegLogInitialOutput}}),Object.defineProperty(t,"safePrintFFmpegArguments",{enumerable:!0,get:function(){return i.safePrintFFmpegArguments}})},431:function(e,t,r){"use strict";var i=this&&this.__createBinding||(Object.create?function(e,t,r,i){void 0===i&&(i=r);var o=Object.getOwnPropertyDescriptor(t,r);o&&!("get"in o?!t.__esModule:o.writable||o.configurable)||(o={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,i,o)}:function(e,t,r,i){void 0===i&&(i=r),e[i]=t[r]}),o=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),n=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)"default"!==r&&Object.prototype.hasOwnProperty.call(e,r)&&i(t,e,r);return o(t,e),t},s=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const a=r(290),c=r(643),d=n(r(743)),p=r(414),u=s(r(317)),l=r(434),m=s(r(896)),h=s(r(278)),f=s(r(857)),g=s(r(893)),y=r(49);class v extends d.ScryptedDeviceBase{constructor(e){super(e),this.storageSettings=new p.StorageSettings(this,{testDevice:{group:"Device",title:"Validation Device",description:"Select a device to validate.",type:"device",deviceFilter:`type === '${d.ScryptedDeviceType.Camera}' || type === '${d.ScryptedDeviceType.Doorbell}'  || type === '${d.ScryptedDeviceType.Notifier}'`,immediate:!0},validateDevice:{console:!0,group:"Device",title:"Validate Device",description:"Validate the device configuration.",type:"button",onPut:async()=>{this.validateDevice()}},validateSystem:{console:!0,group:"System",title:"Validate System",description:"Validate the system configuration.",type:"button",onPut:()=>this.validateSystem()}}),this.loggedMotion=new Map,this.loggedButton=new Map,this.on=this.on||!1,d.default.systemManager.listen(((e,t,r)=>{r&&e?.id&&(t.eventInterface!==d.ScryptedInterface.MotionSensor?t.eventInterface!==d.ScryptedInterface.BinarySensor||this.loggedButton.set(e.id,Date.now()):this.loggedMotion.set(e.id,Date.now()))}))}getSettings(){return this.storageSettings.getSettings()}async putSetting(e,t){await this.storageSettings.putSetting(e,t)}warnStep(e,t){e.log("".padEnd(24),`[33m${t}[0m`)}async validate(e,t,r){try{r instanceof Function&&(r=r()),e.log(t.padEnd(24),"[34mRunning[0m");const i=await r;e.log("".padEnd(24),`[32m${i||"OK"}[0m`)}catch(r){e.error(t.padEnd(24),"[31m Failed[0m".padEnd(24),r.message)}}async validateDevice(){const e=this.storageSettings.values.testDevice,t=d.default.deviceManager.getMixinConsole(e.id);t.log("".padEnd(44,"=")),t.log(`Device Validation: ${e?.name}`),t.log("".padEnd(44,"=")),await this.validate(t,"Device Selected",(async()=>{if(!e)throw new Error("Select a device in the Settings UI.")})),e&&(e.type===d.ScryptedDeviceType.Camera||e.type===d.ScryptedDeviceType.Doorbell?await this.validateCamera(e):e.type===d.ScryptedDeviceType.Notifier&&await this.validateNotifier(e),t.log("".padEnd(44,"=")),t.log(`Device Validation Complete: ${e?.name}`),t.log("".padEnd(44,"=")))}async validateNotifier(e){const t=d.default.deviceManager.getMixinConsole(e.id);await this.validate(t,"Test Notification",(async()=>{const r=await(0,y.httpFetch)({url:"https://home.scrypted.app/_punch/web_hi_res_512.png",responseType:"buffer"}),i=await d.default.mediaManager.createMediaObject(r.body,"image/png");await e.sendNotification("Scrypted Diagnostics",{body:"Body",subtitle:"Subtitle",android:{channel:"diagnostics"}},i),this.warnStep(t,"Check the device for the notification.")}))}async validateCamera(e){const t=d.default.deviceManager.getMixinConsole(e.id);await this.validate(t,"Device Capabilities",(async()=>{if(!e.interfaces.includes(d.ScryptedInterface.MotionSensor))throw new Error("Motion Sensor not found.");if(e.type===d.ScryptedDeviceType.Doorbell&&!e.interfaces.includes(d.ScryptedInterface.BinarySensor))throw new Error("Doorbell button not found.")})),await this.validate(t,"Motion Detection",(async()=>{if(!e.interfaces.includes(d.ScryptedInterface.MotionSensor))throw new Error("Motion Sensor not found. Enabling a software motion sensor extension is recommended.");e.providedInterfaces.includes(d.ScryptedInterface.MotionSensor)&&e.interfaces.find((e=>e.startsWith("ObjectDetection:true")))&&this.warnStep(t,"Camera hardware provides motion events, but a software motion detector is enabled. Consider disabling the software motion detector.")})),e.interfaces.includes(d.ScryptedInterface.MotionSensor)&&await this.validate(t,"Recent Motion",(async()=>{const t=this.loggedMotion.get(e.id);if(!t)throw new Error("No recent motion detected. Go wave your hand in front of the camera.");if(Date.now()-t>288e5)throw new Error("Last motion was over 8 hours ago.")})),e.type===d.ScryptedDeviceType.Doorbell&&await this.validate(t,"Recent Button Press",(async()=>{const t=this.loggedButton.get(e.id);if(!t)throw new Error("No recent button press detected. Go press the doorbell button.");if(Date.now()-t>288e5)throw new Error("Last button press was over 8 hours ago.")}));const r=async(r,i,o=!1,n)=>{await this.validate(t,r,(async()=>{if(o&&!e.interfaces.includes(d.ScryptedInterface.Camera))throw new Error("Snapshot not supported. Enable the Snapshot extension.");const r=await d.default.mediaManager.convertMediaObjectToBuffer(await i,"image/jpeg"),s=await(0,g.default)(r).metadata();if(!s.width||!s.height||s.width<100||s.height<100)throw new Error("Malformed image.");!n&&o&&"@scrypted/unifi-protect"===e.pluginId&&s.width<1280&&this.warnStep(t,"Unifi Protect provides low quality snapshots. Consider using Snapshot from Prebuffer for full resolution screenshots."),await(n?.())}))};await r("Snapshot",e.takePicture({reason:"event"}),!0),await this.validate(t,"Streams",(async()=>{const r=await e.getVideoStreamOptions();if(!r?.length)throw new Error("Stream configuration invalid.");r.length<3&&this.warnStep(t,`Camera has ${r.length} substream. Three streams are recommended.`);r.filter((e=>"cloud"===e.source)).length&&this.warnStep(t,"Cloud camera. Upgrade recommended.");r.filter((e=>e.destinations?.length)).length<Math.min(3,r.length)&&this.warnStep(t,"Unused streams detected.")}));const i=async t=>{if(!e.interfaces.includes(d.ScryptedInterface.VideoCamera))throw new Error("Streaming not supported.");return await e.getVideoStream({destination:t,prebuffer:0})},o=new Set,n=async(n,s)=>{const a=await e.getVideoStreamOptions(),c=a.find((e=>e.destinations?.includes(s)))?.id;if(o.has(c))return void await this.validate(t,n,(async()=>"Skipped (Duplicate)"));o.add(c);const p=await d.default.mediaManager.convertMediaObjectToJSON(await i(s),d.ScryptedMimeTypes.FFmpegInput);"h264"!==p.mediaStreamOptions?.video?.codec&&this.warnStep(t,`Stream ${n} is using codec ${p.mediaStreamOptions?.video?.codec}. h264 is recommended.`),await r(n,i(s));const u=Date.now();await r(n+" (IDR)",i(s),!1,(async()=>{if(Date.now()-u>5e3)throw new Error("High IDR Interval. This may cause issues with HomeKit Secure Video. Adjust codec configuration if possible.")}))};await n("Local","local"),await n("Local Recorder","local-recorder"),await n("Remote Recorder","remote-recorder"),await n("Remote","remote"),await n("Low Resolution","low-resolution"),await this.validate(t,"Audio Codecs",(async()=>{const r=await e.getVideoStreamOptions();let i;const o=new Set;for(const e of r)e.audio?.codec&&(i=e.audio.codec,o.add(e.audio.codec));o.size>1?this.warnStep(t,"Mismatched audio codecs detected."):i&&("pcm_mulaw"===i||"aac"===i||"opus"===i||this.warnStep(t,`Audio codec is ${i}. pcm_mulaw, aac, or opus is recommended.`))}))}async validateSystem(){this.console.log("".padEnd(44,"=")),this.console.log("System Validation"),this.console.log("".padEnd(44,"="));const e=d.default.systemManager.getDeviceById("@scrypted/nvr"),t=d.default.systemManager.getDeviceById("@scrypted/cloud"),r=process.env.NVIDIA_VISIBLE_DEVICES&&process.env.NVIDIA_DRIVER_CAPABILITIES,i=d.default.systemManager.getDeviceById("@scrypted/onnx"),o=d.default.systemManager.getDeviceById("@scrypted/openvino");await this.validate(this.console,"Scrypted Installation",(async()=>{const e=process.env.SCRYPTED_INSTALL_ENVIRONMENT;if("linux"===process.platform){if("docker"!==e&&"lxc"!==e&&"ha"!==e&&"lxc-docker"!==e)throw new Error("Unrecognized Linux installation. Installation via Docker image or the official Proxmox LXC script (not tteck) is recommended: https://docs.scrypted.app/installation")}else"electron"!==e&&this.warnStep(this.console,"Upgrading to the Scrypted Desktop application is recommened for Windows and macOS.")})),await this.validate(this.console,"IPv4 (jsonip.com)",(0,y.httpFetch)({url:"https://jsonip.com",family:4,responseType:"json",timeout:5e3}).then((e=>e.body.ip))),await this.validate(this.console,"IPv6 (jsonip.com)",(0,y.httpFetch)({url:"https://jsonip.com",family:6,responseType:"json",timeout:5e3}).then((e=>e.body.ip))),await this.validate(this.console,"IPv4 (wtfismyip.com)",(0,y.httpFetch)({url:"https://wtfismyip.com/text",family:4,responseType:"text",timeout:5e3}).then((e=>e.body.trim()))),await this.validate(this.console,"IPv6 (wtfismyip.com)",(0,y.httpFetch)({url:"https://wtfismyip.com/text",family:6,responseType:"text",timeout:5e3}).then((e=>e.body.trim()))),await this.validate(this.console,"Scrypted Server Address",(async()=>{const e=await d.default.endpointManager.getLocalAddresses(),t=e?.find((e=>h.default.isIPv4(e))),r=e?.find((e=>h.default.isIPv6(e)));if(e?.length&&this.warnStep(this.console,e.join(", ")),!t)throw new Error("Scrypted Settings IPv4 address not set.");if(!r)throw new Error("Scrypted Settings IPv6 address not set.")})),await this.validate(this.console,"CPU Count",(async()=>{if(f.default.cpus().length<2)throw new Error("CPU Count is too low. 4 CPUs are recommended.");return f.default.cpus().length})),await this.validate(this.console,"Memory",(async()=>{if(e){if(f.default.totalmem()<15032385536)throw new Error("Memory is too low. 16GB is recommended for NVR.");return Math.floor(f.default.totalmem()/1024/1024/1024)+" GB"}if(f.default.totalmem()<8589934592)throw new Error("Memory is too low. 8GB is recommended.")})),"linux"===process.platform&&e&&await this.validate(this.console,"GPU Passthrough",(async()=>{if(!m.default.existsSync("/dev/dri/renderD128")&&!m.default.existsSync("/dev/dri/renderD129"))throw new Error("GPU device unvailable or not passed through to container. (/dev/dri/renderD128, /dev/dri/renderD129)");if(f.default.cpus().find((e=>e.model.includes("AMD")))&&!m.default.existsSync("/dev/kfd"))throw new Error("GPU device unvailable or not passed through to container. (/dev/kfd)")})),await this.validate(this.console,"Cloud Plugin",(async()=>{if(!t)return void this.warnStep(this.console,"Cloud plugin not installed. Consider installing for remote access.");const e=await(0,y.httpFetch)({url:"https://home.scrypted.app/_punch/web_hi_res_512.png",responseType:"buffer"}),r=await d.default.mediaManager.createMediaObject(e.body,"image/png"),i=await d.default.mediaManager.convertMediaObjectToUrl(r,"image/png"),o=await(0,y.httpFetch)({url:i,responseType:"buffer"});if(Buffer.compare(e.body,o.body))throw new Error("Invalid response received.");const n=await d.default.mediaManager.convertMediaObject(r,d.ScryptedMimeTypes.Url+";short-lived=true"),s=await(0,y.httpFetch)({url:n.toString(),responseType:"buffer"});if(Buffer.compare(e.body,s.body))throw new Error("Invalid response received from short lived URL.")})),(r||"win32"===process.platform)&&i&&await this.validate(this.console,"ONNX Plugin",(async()=>{const e=(await i.getSettings()).find((e=>"execution_device"===e.key));e?.value?.toString().includes("CPU")&&this.warnStep(this.console,"GPU device unvailable or not passed through to container.");const t=await d.default.mediaManager.createMediaObjectFromUrl("https://docs.scrypted.app/img/scrypted-nvr/troubleshooting/zidane.jpg");if(!(await i.detectObjects(t)).detections.find((e=>"person"===e.className&&e.score>.9)))throw new Error("Person not detected in test image.")})),r||!o||"win32"===process.platform&&i||await this.validate(this.console,"OpenVINO Plugin",(async()=>{const e=(await o.getSettings()).find((e=>"available_devices"===e.key));e?.value?.toString().includes("GPU")||this.warnStep(this.console,"GPU device unvailable or not passed through to container.");const t=await d.default.mediaManager.createMediaObjectFromUrl("https://docs.scrypted.app/img/scrypted-nvr/troubleshooting/zidane.jpg");if(!(await o.detectObjects(t)).detections.find((e=>"person"===e.className&&e.score>.9)))throw new Error("Person not detected in test image.")})),e&&(await this.validate(this.console,"GPU Decode",(async()=>{const e=await d.default.mediaManager.getFFmpegPath();let t=!1;{const r=["-y","-hwaccel","auto","-i","https://github.com/koush/scrypted-sample-cameraprovider/raw/main/fs/dog.mp4","-f","rawvideo","pipe:3"],i=u.default.spawn(e,r,{stdio:["pipe","pipe","pipe","pipe"]}),o=new a.Deferred;o.promise.catch((()=>{})).finally((()=>(0,c.safeKillFFmpeg)(i))),i.stdio[3]?.on("data",(()=>{})),i.stderr.on("data",(e=>{const r=e.toString();t||=r.includes("Using auto hwaccel type vaapi"),r.includes("nv12")&&o.resolve()})),setTimeout((()=>{o.reject(new Error("GPU Decode timed out."))}),5e3),await o.promise}if(t&&o){const t=["-y","-init_hw_device","vaapi=renderD128:/dev/dri/renderD128","-hwaccel","vaapi","-hwaccel_output_format","vaapi","-i","https://docs.scrypted.app/img/scrypted-nvr/troubleshooting/zidane.jpg","-vf","format=nv12,hwupload,scale_vaapi=w=320:h=-2,hwdownload,format=nv12","-f","mjpeg","-frames:v","1","pipe:3"],r=u.default.spawn(e,t,{stdio:["pipe","pipe","pipe","pipe"]});let i="";r.stderr.on("data",(e=>{i+=e.toString()})),r.stdout.on("data",(e=>{i+=e.toString()}));const n=[];r.stdio[3]?.on("data",(e=>{n.push(e)})),setTimeout((()=>{(0,c.safeKillFFmpeg)(r)}),5e3);const[s]=await(0,l.once)(r,"exit");if(s)throw this.warnStep(this.console,i),new Error("GPU Transform failed.");const a=Buffer.concat(n),p=await d.default.mediaManager.createMediaObject(a,"image/jpeg");if(320!==(await d.default.mediaManager.convertMediaObject(p,d.ScryptedMimeTypes.Image)).width)throw new Error("Unexpected image with from GPU transform.");if(!(await o.detectObjects(p)).detections.find((e=>"person"===e.className&&e.score>.9)))throw new Error("Person not detected in test image.")}})),await this.validate(this.console,"Deprecated Plugins",(async()=>{const e=["@scrypted/electron-core","@scrypted/opencv","@scrypted/python-codecs","@scrypted/pam-diff"];let t=!1;for(const r of e){d.default.systemManager.getDeviceById(r)&&(this.warnStep(this.console,`Scrypted NVR users can remove: ${r}`),t=!0)}if(t)throw new Error("Deprecated plugins found.")}))),this.console.log("".padEnd(44,"=")),this.console.log("System Validation Complete"),this.console.log("".padEnd(44,"="))}}t.default=v},290:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Deferred=void 0;t.Deferred=class{constructor(){this.finished=!1,this.promise=new Promise(((e,t)=>{this.resolve=t=>(this.finished=!0,e(t),this),this.reject=e=>(this.finished=!0,t(e),this)}))}async resolvePromise(e){try{this.resolve(await e)}catch(e){this.reject(e)}}}},49:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.getHttpFetchParser=d,t.httpFetchParseIncomingMessage=p,t.httpFetch=async function(e){const t=(0,i.createHeadersArray)(e.headers);(0,i.setDefaultHttpFetchAccept)(t,e.responseType);const{once:n}=r(434),{PassThrough:s,Readable:a}=r(203),{http:c,https:d}=r(165),{url:u}=e,l=u.toString().startsWith("https:")?d:c;let m,h,{body:f}=e;if(f&&!(f instanceof a)){const e=new s;e.write(Buffer.from((0,i.createStringOrBufferBody)(t,f))),e.end(),f=e}e.timeout&&(m=new AbortController,h=setTimeout((()=>m.abort()),e.timeout),e.signal?.addEventListener("abort",(()=>m.abort(e.signal?.reason))));const g=m?.signal||e.signal;g?.addEventListener("abort",(()=>v.destroy(new Error(e.signal?.reason||"abort"))));const y={};for(const[e,r]of t)y[e]?y[e].push(r):y[e]=[r];const v=l.request(u,{method:(0,i.getFetchMethod)(e),rejectUnauthorized:e.rejectUnauthorized,family:e.family,headers:y,signal:g,timeout:e.timeout});f?f.pipe(v):v.end();try{const[t]=await n(v,"response");if(void 0===e?.checkStatusCode||e?.checkStatusCode)try{const r="function"==typeof e?.checkStatusCode?e.checkStatusCode:i.checkStatus;if(!t.statusCode||!r(t.statusCode))throw new Error(`http response statusCode ${t.statusCode}`)}catch(e){throw o(t).catch((()=>{})),e}const r=new Headers;for(const[e,i]of Object.entries(t.headers))for(const t of"string"==typeof i?[i]:i)r.append(e,t);return{statusCode:t.statusCode,headers:r,body:await p(t,e.responseType)}}finally{clearTimeout(h)}};const i=r(258);async function o(e){const t=[];e.on("data",(e=>t.push(e)));const{once:i}=r(434);return await i(e,"end"),Buffer.concat(t)}const n={parse:async e=>(await o(e)).toString()},s={parse:async e=>JSON.parse((await o(e)).toString())},a={parse:async e=>o(e)},c={parse:async e=>e};function d(e){switch(e){case"json":return s;case"text":return n;case"readable":return c}return a}function p(e,t){return d(t).parse(e)}},258:(e,t)=>{"use strict";function r(e){return e>=200&&e<=299}function i(e){if(!r(e))throw new Error(`http response statusCode ${e}`);return!0}function o(e){return e.method||(e.body?"POST":"GET")}function n(e){switch(e){case"json":return"application/json";case"text":return"text/plain"}}function s(e,t){return t=t.toLowerCase(),e.find((([e])=>e.toLowerCase()===t))}function a(e,t){t=t.toLowerCase();const r=e.filter((([e,r])=>e.toLowerCase()!==t));e.length=0,r.forEach((t=>e.push(t)))}function c(e,t,r){a(e,t),e.push([t,r])}function d(e,t){if(s(e,"Accept"))return;const r=n(t);r&&c(e,"Accept",r)}function p(e){const t=[];if(!e)return t;if(e instanceof Headers){for(const[r,i]of e.entries())t.push([r,i]);return t}if(e instanceof Array){for(const[r,i]of e)t.push([r,i]);return t}for(const r of Object.keys(e)){const i=e[r];t.push([r,i])}return t}function u(e,t){let r;return"object"==typeof t?(t=JSON.stringify(t),r="application/json"):"string"==typeof t&&(r="text/plain"),r&&!s(e,"Content-Type")&&c(e,"Content-Type",r),s(e,"Content-Length")||c(e,"Content-Length",(t=Buffer.from(t)).length.toString()),t}async function l(e,t){switch(t){case"json":return e.json();case"text":return e.text();case"readable":return e}return new Uint8Array(await e.arrayBuffer())}Object.defineProperty(t,"__esModule",{value:!0}),t.fetchStatusCodeOk=r,t.checkStatus=i,t.getFetchMethod=o,t.getHttpFetchAccept=n,t.hasHeader=s,t.removeHeader=a,t.setHeader=c,t.setDefaultHttpFetchAccept=d,t.createHeadersArray=p,t.createStringOrBufferBody=u,t.domFetchParseIncomingMessage=l,t.domFetch=async function(e){const t=p(e.headers);d(t,e.responseType);let r,n,{body:s}=e;!s||s instanceof ReadableStream||(s=u(t,s));e.timeout&&(r=new AbortController,n=setTimeout((()=>r.abort()),e.timeout),e.signal?.addEventListener("abort",(()=>r.abort(e.signal?.reason))));try{const{url:n}=e,a=await fetch(n,{method:o(e),credentials:e.withCredentials?"include":void 0,headers:t,signal:r?.signal||e.signal,body:s});if(void 0===e?.checkStatusCode||e?.checkStatusCode)try{if(!("function"==typeof e?.checkStatusCode?e.checkStatusCode:i)(a.status))throw new Error(`http response statusCode ${a.status}`)}catch(e){throw a.arrayBuffer().catch((()=>{})),e}return{statusCode:a.status,headers:a.headers,body:await l(a,e.responseType)}}finally{clearTimeout(n)}}},989:function(e,t,r){"use strict";var i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.safeKillFFmpeg=async function(e){if(!e)return;if(null!=e.exitCode)return;await new Promise((async t=>{e.on("exit",t);try{e.stdin.on("error",(()=>{})),e.stdin.write("q\n")}catch(e){}await(0,n.sleep)(2e3);for(const t of e.stdio)try{t?.destroy()}catch(e){}e.kill(),await(0,n.sleep)(2e3),e.kill("SIGKILL")}))},t.ffmpegLogInitialOutput=function(e,t,r,i){if(!e)return;const n=!!o.default.env.SCRYPTED_FFMPEG_NOISY||!!i?.getItem("SCRYPTED_FFMPEG_NOISY");function a(e){const i=o=>{const a=o.toString();for(const e of s)if(-1!==a.indexOf(e))return;if(!(n||r||-1===a.indexOf("frame=")&&-1===a.indexOf("size=")))return e(a),e("video/audio detected, discarding further input"),t.stdout.removeListener("data",i),void t.stderr.removeListener("data",i);e(a)};return i}t.stdout?.on("data",a(e.log)),t.stderr?.on("data",a(e.error)),t.on("exit",(()=>e.log("ffmpeg exited")))},t.safePrintFFmpegArguments=function(e,t){if(!e)return;const r=[];let i=!1;for(const e of t){try{if(i){const t=new URL(e);r.push(`${t.protocol}[REDACTED]`)}else r.push(e)}catch(t){r.push(e)}i="-i"===e}e.log(r.join(" "))};const o=i(r(932)),n=r(610),s=["decode_slice_header error","no frame!","non-existing PPS"]},610:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.sleep=async function(e){await new Promise((t=>setTimeout(t,e)))}},893:e=>{const t=require("sharp");e.exports=t},710:(e,t,r)=>{t.formatArgs=function(t){if(t[0]=(this.useColors?"%c":"")+this.namespace+(this.useColors?" %c":" ")+t[0]+(this.useColors?"%c ":" ")+"+"+e.exports.humanize(this.diff),!this.useColors)return;const r="color: "+this.color;t.splice(1,0,r,"color: inherit");let i=0,o=0;t[0].replace(/%[a-zA-Z%]/g,(e=>{"%%"!==e&&(i++,"%c"===e&&(o=i))})),t.splice(o,0,r)},t.save=function(e){try{e?t.storage.setItem("debug",e):t.storage.removeItem("debug")}catch(e){}},t.load=function(){let e;try{e=t.storage.getItem("debug")}catch(e){}!e&&"undefined"!=typeof process&&"env"in process&&(e=process.env.DEBUG);return e},t.useColors=function(){if("undefined"!=typeof window&&window.process&&("renderer"===window.process.type||window.process.__nwjs))return!0;if("undefined"!=typeof navigator&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/(edge|trident)\/(\d+)/))return!1;return"undefined"!=typeof document&&document.documentElement&&document.documentElement.style&&document.documentElement.style.WebkitAppearance||"undefined"!=typeof window&&window.console&&(window.console.firebug||window.console.exception&&window.console.table)||"undefined"!=typeof navigator&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/firefox\/(\d+)/)&&parseInt(RegExp.$1,10)>=31||"undefined"!=typeof navigator&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/applewebkit\/(\d+)/)},t.storage=function(){try{return localStorage}catch(e){}}(),t.destroy=(()=>{let e=!1;return()=>{e||(e=!0,console.warn("Instance method `debug.destroy()` is deprecated and no longer does anything. It will be removed in the next major version of `debug`."))}})(),t.colors=["#0000CC","#0000FF","#0033CC","#0033FF","#0066CC","#0066FF","#0099CC","#0099FF","#00CC00","#00CC33","#00CC66","#00CC99","#00CCCC","#00CCFF","#3300CC","#3300FF","#3333CC","#3333FF","#3366CC","#3366FF","#3399CC","#3399FF","#33CC00","#33CC33","#33CC66","#33CC99","#33CCCC","#33CCFF","#6600CC","#6600FF","#6633CC","#6633FF","#66CC00","#66CC33","#9900CC","#9900FF","#9933CC","#9933FF","#99CC00","#99CC33","#CC0000","#CC0033","#CC0066","#CC0099","#CC00CC","#CC00FF","#CC3300","#CC3333","#CC3366","#CC3399","#CC33CC","#CC33FF","#CC6600","#CC6633","#CC9900","#CC9933","#CCCC00","#CCCC33","#FF0000","#FF0033","#FF0066","#FF0099","#FF00CC","#FF00FF","#FF3300","#FF3333","#FF3366","#FF3399","#FF33CC","#FF33FF","#FF6600","#FF6633","#FF9900","#FF9933","#FFCC00","#FFCC33"],t.log=console.debug||console.log||(()=>{}),e.exports=r(729)(t);const{formatters:i}=e.exports;i.j=function(e){try{return JSON.stringify(e)}catch(e){return"[UnexpectedJSONParseError]: "+e.message}}},729:(e,t,r)=>{e.exports=function(e){function t(e){let r,o,n,s=null;function a(...e){if(!a.enabled)return;const i=a,o=Number(new Date),n=o-(r||o);i.diff=n,i.prev=r,i.curr=o,r=o,e[0]=t.coerce(e[0]),"string"!=typeof e[0]&&e.unshift("%O");let s=0;e[0]=e[0].replace(/%([a-zA-Z%])/g,((r,o)=>{if("%%"===r)return"%";s++;const n=t.formatters[o];if("function"==typeof n){const t=e[s];r=n.call(i,t),e.splice(s,1),s--}return r})),t.formatArgs.call(i,e);(i.log||t.log).apply(i,e)}return a.namespace=e,a.useColors=t.useColors(),a.color=t.selectColor(e),a.extend=i,a.destroy=t.destroy,Object.defineProperty(a,"enabled",{enumerable:!0,configurable:!1,get:()=>null!==s?s:(o!==t.namespaces&&(o=t.namespaces,n=t.enabled(e)),n),set:e=>{s=e}}),"function"==typeof t.init&&t.init(a),a}function i(e,r){const i=t(this.namespace+("undefined"==typeof r?":":r)+e);return i.log=this.log,i}function o(e){return e.toString().substring(2,e.toString().length-2).replace(/\.\*\?$/,"*")}return t.debug=t,t.default=t,t.coerce=function(e){if(e instanceof Error)return e.stack||e.message;return e},t.disable=function(){const e=[...t.names.map(o),...t.skips.map(o).map((e=>"-"+e))].join(",");return t.enable(""),e},t.enable=function(e){let r;t.save(e),t.namespaces=e,t.names=[],t.skips=[];const i=("string"==typeof e?e:"").split(/[\s,]+/),o=i.length;for(r=0;r<o;r++)i[r]&&("-"===(e=i[r].replace(/\*/g,".*?"))[0]?t.skips.push(new RegExp("^"+e.slice(1)+"$")):t.names.push(new RegExp("^"+e+"$")))},t.enabled=function(e){if("*"===e[e.length-1])return!0;let r,i;for(r=0,i=t.skips.length;r<i;r++)if(t.skips[r].test(e))return!1;for(r=0,i=t.names.length;r<i;r++)if(t.names[r].test(e))return!0;return!1},t.humanize=r(368),t.destroy=function(){console.warn("Instance method `debug.destroy()` is deprecated and no longer does anything. It will be removed in the next major version of `debug`.")},Object.keys(e).forEach((r=>{t[r]=e[r]})),t.names=[],t.skips=[],t.formatters={},t.selectColor=function(e){let r=0;for(let t=0;t<e.length;t++)r=(r<<5)-r+e.charCodeAt(t),r|=0;return t.colors[Math.abs(r)%t.colors.length]},t.enable(t.load()),t}},470:(e,t,r)=>{"undefined"==typeof process||"renderer"===process.type||!0===process.browser||process.__nwjs?e.exports=r(710):e.exports=r(148)},148:(e,t,r)=>{const i=r(18),o=r(23);t.init=function(e){e.inspectOpts={};const r=Object.keys(t.inspectOpts);for(let i=0;i<r.length;i++)e.inspectOpts[r[i]]=t.inspectOpts[r[i]]},t.log=function(...e){return process.stderr.write(o.format(...e)+"\n")},t.formatArgs=function(r){const{namespace:i,useColors:o}=this;if(o){const t=this.color,o="[3"+(t<8?t:"8;5;"+t),n=`  ${o};1m${i} [0m`;r[0]=n+r[0].split("\n").join("\n"+n),r.push(o+"m+"+e.exports.humanize(this.diff)+"[0m")}else r[0]=function(){if(t.inspectOpts.hideDate)return"";return(new Date).toISOString()+" "}()+i+" "+r[0]},t.save=function(e){e?process.env.DEBUG=e:delete process.env.DEBUG},t.load=function(){return process.env.DEBUG},t.useColors=function(){return"colors"in t.inspectOpts?Boolean(t.inspectOpts.colors):i.isatty(process.stderr.fd)},t.destroy=o.deprecate((()=>{}),"Instance method `debug.destroy()` is deprecated and no longer does anything. It will be removed in the next major version of `debug`."),t.colors=[6,2,3,4,5,1];try{const e=r(Object(function(){var e=new Error("Cannot find module 'supports-color'");throw e.code="MODULE_NOT_FOUND",e}()));e&&(e.stderr||e).level>=2&&(t.colors=[20,21,26,27,32,33,38,39,40,41,42,43,44,45,56,57,62,63,68,69,74,75,76,77,78,79,80,81,92,93,98,99,112,113,128,129,134,135,148,149,160,161,162,163,164,165,166,167,168,169,170,171,172,173,178,179,184,185,196,197,198,199,200,201,202,203,204,205,206,207,208,209,214,215,220,221])}catch(e){}t.inspectOpts=Object.keys(process.env).filter((e=>/^debug_/i.test(e))).reduce(((e,t)=>{const r=t.substring(6).toLowerCase().replace(/_([a-z])/g,((e,t)=>t.toUpperCase()));let i=process.env[t];return i=!!/^(yes|on|true|enabled)$/i.test(i)||!/^(no|off|false|disabled)$/i.test(i)&&("null"===i?null:Number(i)),e[r]=i,e}),{}),e.exports=r(729)(t);const{formatters:n}=e.exports;n.o=function(e){return this.inspectOpts.colors=this.useColors,o.inspect(e,this.inspectOpts).split("\n").map((e=>e.trim())).join(" ")},n.O=function(e){return this.inspectOpts.colors=this.useColors,o.inspect(e,this.inspectOpts)}},370:(e,t,r)=>{var i;e.exports=function(){if(!i){try{i=r(470)("follow-redirects")}catch(e){}"function"!=typeof i&&(i=function(){})}i.apply(null,arguments)}},165:(e,t,r)=>{var i,o,n,s=r(16),a=s.URL,c=r(611),d=r(692),p=r(203).Writable,u=r(613),l=r(370);i="undefined"!=typeof process,o="undefined"!=typeof window&&"undefined"!=typeof document,n=E(Error.captureStackTrace),i||!o&&n||console.warn("The follow-redirects package should be excluded from browser builds.");var m=!1;try{u(new a(""))}catch(e){m="ERR_INVALID_URL"===e.code}var h=["auth","host","hostname","href","path","pathname","port","protocol","query","search","hash"],f=["abort","aborted","connect","error","socket","timeout"],g=Object.create(null);f.forEach((function(e){g[e]=function(t,r,i){this._redirectable.emit(e,t,r,i)}}));var y=x("ERR_INVALID_URL","Invalid URL",TypeError),v=x("ERR_FR_REDIRECTION_FAILURE","Redirected request failed"),S=x("ERR_FR_TOO_MANY_REDIRECTS","Maximum number of redirects exceeded",v),w=x("ERR_FR_MAX_BODY_LENGTH_EXCEEDED","Request body larger than maxBodyLength limit"),C=x("ERR_STREAM_WRITE_AFTER_END","write after end"),b=p.prototype.destroy||M;function D(e,t){p.call(this),this._sanitizeOptions(e),this._options=e,this._ended=!1,this._ending=!1,this._redirectCount=0,this._redirects=[],this._requestBodyLength=0,this._requestBodyBuffers=[],t&&this.on("response",t);var r=this;this._onNativeResponse=function(e){try{r._processResponse(e)}catch(e){r.emit("error",e instanceof v?e:new v({cause:e}))}},this._performRequest()}function O(e){var t={maxRedirects:21,maxBodyLength:10485760},r={};return Object.keys(e).forEach((function(i){var o=i+":",n=r[o]=e[i],s=t[i]=Object.create(n);Object.defineProperties(s,{request:{value:function(e,i,n){var s;return s=e,a&&s instanceof a?e=I(e):F(e)?e=I(P(e)):(n=i,i=_(e),e={protocol:o}),E(i)&&(n=i,i=null),(i=Object.assign({maxRedirects:t.maxRedirects,maxBodyLength:t.maxBodyLength},e,i)).nativeProtocols=r,F(i.host)||F(i.hostname)||(i.hostname="::1"),u.equal(i.protocol,o,"protocol mismatch"),l("options",i),new D(i,n)},configurable:!0,enumerable:!0,writable:!0},get:{value:function(e,t,r){var i=s.request(e,t,r);return i.end(),i},configurable:!0,enumerable:!0,writable:!0}})})),t}function M(){}function P(e){var t;if(m)t=new a(e);else if(!F((t=_(s.parse(e))).protocol))throw new y({input:e});return t}function _(e){if(/^\[/.test(e.hostname)&&!/^\[[:0-9a-f]+\]$/i.test(e.hostname))throw new y({input:e.href||e});if(/^\[/.test(e.host)&&!/^\[[:0-9a-f]+\](:\d+)?$/i.test(e.host))throw new y({input:e.href||e});return e}function I(e,t){var r=t||{};for(var i of h)r[i]=e[i];return r.hostname.startsWith("[")&&(r.hostname=r.hostname.slice(1,-1)),""!==r.port&&(r.port=Number(r.port)),r.path=r.search?r.pathname+r.search:r.pathname,r}function T(e,t){var r;for(var i in t)e.test(i)&&(r=t[i],delete t[i]);return null===r||"undefined"==typeof r?void 0:String(r).trim()}function x(e,t,r){function i(r){E(Error.captureStackTrace)&&Error.captureStackTrace(this,this.constructor),Object.assign(this,r||{}),this.code=e,this.message=this.cause?t+": "+this.cause.message:t}return i.prototype=new(r||Error),Object.defineProperties(i.prototype,{constructor:{value:i,enumerable:!1},name:{value:"Error ["+e+"]",enumerable:!1}}),i}function R(e,t){for(var r of f)e.removeListener(r,g[r]);e.on("error",M),e.destroy(t)}function F(e){return"string"==typeof e||e instanceof String}function E(e){return"function"==typeof e}D.prototype=Object.create(p.prototype),D.prototype.abort=function(){R(this._currentRequest),this._currentRequest.abort(),this.emit("abort")},D.prototype.destroy=function(e){return R(this._currentRequest,e),b.call(this,e),this},D.prototype.write=function(e,t,r){if(this._ending)throw new C;if(!F(e)&&("object"!=typeof(i=e)||!("length"in i)))throw new TypeError("data should be a string, Buffer or Uint8Array");var i;E(t)&&(r=t,t=null),0!==e.length?this._requestBodyLength+e.length<=this._options.maxBodyLength?(this._requestBodyLength+=e.length,this._requestBodyBuffers.push({data:e,encoding:t}),this._currentRequest.write(e,t,r)):(this.emit("error",new w),this.abort()):r&&r()},D.prototype.end=function(e,t,r){if(E(e)?(r=e,e=t=null):E(t)&&(r=t,t=null),e){var i=this,o=this._currentRequest;this.write(e,t,(function(){i._ended=!0,o.end(null,null,r)})),this._ending=!0}else this._ended=this._ending=!0,this._currentRequest.end(null,null,r)},D.prototype.setHeader=function(e,t){this._options.headers[e]=t,this._currentRequest.setHeader(e,t)},D.prototype.removeHeader=function(e){delete this._options.headers[e],this._currentRequest.removeHeader(e)},D.prototype.setTimeout=function(e,t){var r=this;function i(t){t.setTimeout(e),t.removeListener("timeout",t.destroy),t.addListener("timeout",t.destroy)}function o(t){r._timeout&&clearTimeout(r._timeout),r._timeout=setTimeout((function(){r.emit("timeout"),n()}),e),i(t)}function n(){r._timeout&&(clearTimeout(r._timeout),r._timeout=null),r.removeListener("abort",n),r.removeListener("error",n),r.removeListener("response",n),r.removeListener("close",n),t&&r.removeListener("timeout",t),r.socket||r._currentRequest.removeListener("socket",o)}return t&&this.on("timeout",t),this.socket?o(this.socket):this._currentRequest.once("socket",o),this.on("socket",i),this.on("abort",n),this.on("error",n),this.on("response",n),this.on("close",n),this},["flushHeaders","getHeader","setNoDelay","setSocketKeepAlive"].forEach((function(e){D.prototype[e]=function(t,r){return this._currentRequest[e](t,r)}})),["aborted","connection","socket"].forEach((function(e){Object.defineProperty(D.prototype,e,{get:function(){return this._currentRequest[e]}})})),D.prototype._sanitizeOptions=function(e){if(e.headers||(e.headers={}),e.host&&(e.hostname||(e.hostname=e.host),delete e.host),!e.pathname&&e.path){var t=e.path.indexOf("?");t<0?e.pathname=e.path:(e.pathname=e.path.substring(0,t),e.search=e.path.substring(t))}},D.prototype._performRequest=function(){var e=this._options.protocol,t=this._options.nativeProtocols[e];if(!t)throw new TypeError("Unsupported protocol "+e);if(this._options.agents){var r=e.slice(0,-1);this._options.agent=this._options.agents[r]}var i=this._currentRequest=t.request(this._options,this._onNativeResponse);for(var o of(i._redirectable=this,f))i.on(o,g[o]);if(this._currentUrl=/^\//.test(this._options.path)?s.format(this._options):this._options.path,this._isRedirect){var n=0,a=this,c=this._requestBodyBuffers;!function e(t){if(i===a._currentRequest)if(t)a.emit("error",t);else if(n<c.length){var r=c[n++];i.finished||i.write(r.data,r.encoding,e)}else a._ended&&i.end()}()}},D.prototype._processResponse=function(e){var t=e.statusCode;this._options.trackRedirects&&this._redirects.push({url:this._currentUrl,headers:e.headers,statusCode:t});var r,i=e.headers.location;if(!i||!1===this._options.followRedirects||t<300||t>=400)return e.responseUrl=this._currentUrl,e.redirects=this._redirects,this.emit("response",e),void(this._requestBodyBuffers=[]);if(R(this._currentRequest),e.destroy(),++this._redirectCount>this._options.maxRedirects)throw new S;var o=this._options.beforeRedirect;o&&(r=Object.assign({Host:e.req.getHeader("host")},this._options.headers));var n=this._options.method;((301===t||302===t)&&"POST"===this._options.method||303===t&&!/^(?:GET|HEAD)$/.test(this._options.method))&&(this._options.method="GET",this._requestBodyBuffers=[],T(/^content-/i,this._options.headers));var c,d,p=T(/^host$/i,this._options.headers),h=P(this._currentUrl),f=p||h.host,g=/^\w+:/.test(i)?this._currentUrl:s.format(Object.assign(h,{host:f})),y=(c=i,d=g,m?new a(c,d):P(s.resolve(d,c)));if(l("redirecting to",y.href),this._isRedirect=!0,I(y,this._options),(y.protocol!==h.protocol&&"https:"!==y.protocol||y.host!==f&&!function(e,t){u(F(e)&&F(t));var r=e.length-t.length-1;return r>0&&"."===e[r]&&e.endsWith(t)}(y.host,f))&&T(/^(?:(?:proxy-)?authorization|cookie)$/i,this._options.headers),E(o)){var v={headers:e.headers,statusCode:t},w={url:g,method:n,headers:r};o(this._options,v,w),this._sanitizeOptions(this._options)}this._performRequest()},e.exports=O({http:c,https:d}),e.exports.wrap=O},368:e=>{var t=1e3,r=60*t,i=60*r,o=24*i,n=7*o,s=365.25*o;function a(e,t,r,i){var o=t>=1.5*r;return Math.round(e/r)+" "+i+(o?"s":"")}e.exports=function(e,c){c=c||{};var d=typeof e;if("string"===d&&e.length>0)return function(e){if((e=String(e)).length>100)return;var a=/^(-?(?:\d+)?\.?\d+) *(milliseconds?|msecs?|ms|seconds?|secs?|s|minutes?|mins?|m|hours?|hrs?|h|days?|d|weeks?|w|years?|yrs?|y)?$/i.exec(e);if(!a)return;var c=parseFloat(a[1]);switch((a[2]||"ms").toLowerCase()){case"years":case"year":case"yrs":case"yr":case"y":return c*s;case"weeks":case"week":case"w":return c*n;case"days":case"day":case"d":return c*o;case"hours":case"hour":case"hrs":case"hr":case"h":return c*i;case"minutes":case"minute":case"mins":case"min":case"m":return c*r;case"seconds":case"second":case"secs":case"sec":case"s":return c*t;case"milliseconds":case"millisecond":case"msecs":case"msec":case"ms":return c;default:return}}(e);if("number"===d&&isFinite(e))return c.long?function(e){var n=Math.abs(e);if(n>=o)return a(e,n,o,"day");if(n>=i)return a(e,n,i,"hour");if(n>=r)return a(e,n,r,"minute");if(n>=t)return a(e,n,t,"second");return e+" ms"}(e):function(e){var n=Math.abs(e);if(n>=o)return Math.round(e/o)+"d";if(n>=i)return Math.round(e/i)+"h";if(n>=r)return Math.round(e/r)+"m";if(n>=t)return Math.round(e/t)+"s";return e+"ms"}(e);throw new Error("val is not a non-empty string or a valid number. val="+JSON.stringify(e))}},613:e=>{"use strict";e.exports=require("assert")},317:e=>{"use strict";e.exports=require("child_process")},434:e=>{"use strict";e.exports=require("events")},896:e=>{"use strict";e.exports=require("fs")},611:e=>{"use strict";e.exports=require("http")},692:e=>{"use strict";e.exports=require("https")},278:e=>{"use strict";e.exports=require("net")},857:e=>{"use strict";e.exports=require("os")},932:e=>{"use strict";e.exports=require("process")},203:e=>{"use strict";e.exports=require("stream")},18:e=>{"use strict";e.exports=require("tty")},16:e=>{"use strict";e.exports=require("url")},23:e=>{"use strict";e.exports=require("util")}},t={};var r=function r(i){var o=t[i];if(void 0!==o)return o.exports;var n=t[i]={exports:{}};return e[i].call(n.exports,n,n.exports,r),n.exports}(431),i=exports="undefined"==typeof exports?{}:exports;for(var o in r)i[o]=r[o];r.__esModule&&Object.defineProperty(i,"__esModule",{value:!0})})();
//# sourceMappingURL=main.nodejs.js.map